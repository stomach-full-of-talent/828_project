app:
  description: ''
  icon: 🤖
  icon_background: '#FFEAD5'
  mode: advanced-chat
  name: 行政部-环境因素与危险源识别AI助手
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openai_api_compatible:0.0.16@77274df8fe2632cac66bfd153fcc75aa5e96abbe92b5c611b8984ad9f4cd4457
kind: app
version: 0.3.1
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 15
        file_size_limit: 200
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: if-else
      id: 1753857088359-source-1753864961307-target
      source: '1753857088359'
      sourceHandle: source
      target: '1753864961307'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: llm
      id: 17538650565260-source-17538650652620-target
      source: '17538650565260'
      sourceHandle: source
      target: '17538650652620'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 17538650652620-source-1753865077626-target
      source: '17538650652620'
      sourceHandle: source
      target: '1753865077626'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1753864961307-false-1754535541206-target
      source: '1753864961307'
      sourceHandle: 'false'
      target: '1754535541206'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: knowledge-retrieval
      id: 17545355851260-source-17538650565260-target
      source: '17545355851260'
      sourceHandle: source
      target: '17538650565260'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 1754535541206-source-1754548215938-target
      source: '1754535541206'
      sourceHandle: source
      target: '1754548215938'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: answer
        targetType: code
      id: 1754548215938-source-17545355851260-target
      source: '1754548215938'
      sourceHandle: source
      target: '17545355851260'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1754551409989-false-1754551467900-target
      source: '1754551409989'
      sourceHandle: 'false'
      target: '1754551467900'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 1754551467900-source-1754551494598-target
      source: '1754551467900'
      sourceHandle: source
      target: '1754551494598'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 1754551381078-source-1754551677124-target
      source: '1754551381078'
      sourceHandle: source
      target: '1754551677124'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: if-else
      id: 1754551677124-source-1754551409989-target
      selected: false
      source: '1754551677124'
      sourceHandle: source
      target: '1754551409989'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: answer
      id: 1753864961307-true-1754556756406-target
      source: '1753864961307'
      sourceHandle: 'true'
      target: '1754556756406'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: answer
        targetType: llm
      id: 1754556756406-source-1754551381078-target
      selected: false
      source: '1754556756406'
      sourceHandle: source
      target: '1754551381078'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1754551409989-true-1754535541206-target
      source: '1754551409989'
      sourceHandle: 'true'
      target: '1754535541206'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: 开始
        type: start
        variables:
        - label: 记忆
          max_length: 48
          options:
          - 是
          - 否
          required: true
          type: select
          variable: memory
      height: 90
      id: '1753857088359'
      position:
        x: 30
        y: 268.5
      positionAbsolute:
        x: 30
        y: 268.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: 608335b7-cc52-44e5-a528-cade98681f63
            value: 是
            varType: string
            variable_selector:
            - '1753857088359'
            - memory
          id: 'true'
          logical_operator: and
        desc: ''
        selected: false
        title: IF/ELSE
        type: if-else
      height: 126
      id: '1753864961307'
      position:
        x: 364
        y: 268.5
      positionAbsolute:
        x: 364
        y: 268.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        dataset_ids:
        - MgYhPFLIfn3yIKBc9zA7CvhOwKAFLU843AAcu/1zvwrPvMasupy8VvHZoawoYgPa
        desc: ''
        multiple_retrieval_config:
          reranking_enable: false
          reranking_mode: reranking_model
          reranking_model:
            model: /home/user/Desktop/MODELFILE/bge-reranker-v2-m3
            provider: langgenius/openai_api_compatible/openai_api_compatible
          score_threshold: null
          top_k: 400
          weights:
            keyword_setting:
              keyword_weight: 0.3
            vector_setting:
              embedding_model_name: /home/user/Desktop/MODELFILE/bge-m3
              embedding_provider_name: langgenius/openai_api_compatible/openai_api_compatible
              vector_weight: 0.7
        query_variable_selector:
        - '17545355851260'
        - result
        retrieval_mode: multiple
        selected: false
        title: 知识检索
        type: knowledge-retrieval
      height: 92
      id: '17538650565260'
      position:
        x: 3218
        y: 268.5
      positionAbsolute:
        x: 3218
        y: 268.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: true
          variable_selector:
          - '17538650565260'
          - result
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: /home/user/Desktop/MODELFILE/Qwen3-30B-A3B-think-2507
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: 318771e1-4fe1-4c75-a626-4f5df01111b0
          role: system
          text: "**角色设定**\n您将扮演奥迪威尔传感器公司（Audiowell）的环境、健康与安全（EHS）合规智能助理。您的核心任务是依据公司内部的《环境因素识别与评价表》和《危险源识别与评价一览表》，为员工提供快速、准确的信息查询与初步分析服务。\n\
            \n**核心指令**\n请严格遵循以下步骤和规范处理用户的每一个问题：\n\n**第一步：理解用户问题**\n深入分析用户提出的问题，精准识别以下一个或多个关键信息：\n\
            *   **主体对象**：设备名称、工作活动、物料等（如“空压机房”、“化学品仓库”、“焊接作业”）。\n*   **关注焦点**：环境因素（如“噪声”、“废水”）或危险源（如“触电”、“火灾”）。\n\
            *   **风险定性**：风险等级或评分（如“重大风险”、“D值大于100”）。\n*   **时间维度**：当前状况、历史记录、未来潜在风险等。\n\
            *   **其他要素**：法规标准、控制措施、责任部门等。\n\n**第二步：在知识库中搜索**\n您将获得一份作为上下文的知识库文档（即《环境因素识别与评价表》或《危险源识别与评价一览表》）。请执行以下搜索协议：\n\
            1.  **优先精确匹配**：首先查找与用户问题中的关键词完全匹配的条目。\n2.  **扩展语义匹配**：若无精确匹配，则搜索同义词或高度相关的术语（例如，用户问“能源使用”，可匹配文档中的“电能消耗”、“天然气消耗”）。\n\
            3.  **聚焦搜索范围**：\n    *   若问题涉及**风险等级**，重点扫描文档中包含“评价分数”、“风险等级”、“控制措施”等字段的区域。\n\
            \    *   若问题涉及**未来风险**，重点关注文档中关于“法规更新预测”、“潜在影响”、“持续监控”等部分。\n知识库上下文：{{#context#}}\n\
            \n**第三步：构建与响应**\n您的回答必须遵循以下规范：\n\n**1. 响应格式要求：**\n*   **精确简洁**：只提供与问题直接相关的信息，避免无关的细节。\n\
            *   **引用来源**：必须注明信息来源的具体章节或编号，以确保权威性。格式为：“根据 `[文档编号]` 第 `[章节/行号]`...”。\n\
            \n**2. 响应逻辑要求：**\n*   **A. 当在知识库中找到匹配项时：**\n    *   直接、清晰地回答用户的问题。\n \
            \   *   如果用户问及风险的严重性，请根据下方的**【背景知识与定义】**模块中的评分标准（D=L×E×C），解释该风险项的L、E、C评分，并说明其风险等级是如何评定的。\n\
            \n*   **B. 当在知识库中未找到匹配项时：**\n    *   首先礼貌地告知用户：“抱歉，在知识库中未能直接找到关于‘[用户查询的核心词]’的准确信息。”\n\
            \    *   然后，尝试提供有帮助的下一步建议，例如：“您是否想查询与之相关的‘[某个相似的设备/因素]’？”\n    *   最后，可以基于知识库中的类似条目和评分标准，进行一次**审慎的初步分析**。例如：“虽然没有‘新型激光打标机’的数据，但参考‘传统油墨喷码机’（D值为XX）的风险，并考虑到激光可能带来的辐射风险，我们可以初步推断其风险点可能在于...。但这需要经过正式的EHS评估确认。”\n\
            \n---\n\n### **【背景知识与定义】**\n*(此模块为您执行任务所需的核心参考信息)*\n\n**A. 环境因素类别代码**\n\
            *   1: 废水\n*   2: 废气 (含臭氧层消耗物质)\n*   3: 噪音\n*   4: 固废 (含危险废物)\n*   5:\
            \ 能源/资源消耗\n*   6: 紧急情况\n*   7: 其他 (光/热辐射等)\n \n**B. 危险源类别**\n*   1: 物理性危害、危险因素\n\
            *   2: 化学性危害、危险因素\n*   3: 生物性危害、危险因素\n*   4: 心理、生理性危害、危险因素\n*   5: 行为性危害、危险因素\n\
            *   6: 其他\n \n**C. 事故类型**\n*   1: 物体打击, 2: 车辆伤害, 3: 机械工具伤害, 4: 起重伤害, 5:\
            \ 触电, 6: 淹溺, 7: 灼烫, 8: 火灾, 9: 高空坠落, 10: 坍塌, 11: 冒顶片帮, 12: 透水, 13: 放炮,\
            \ 14: 火药爆炸, 15: 瓦斯爆炸, 16: 锅炉爆炸, 17: 容器爆炸, 18: 其他爆炸, 19: 中毒窒息, 20: 其他伤害。\n\
             \n**D. 危险源风险评分标准 (D = L × E × C)**\n*   **L (事故发生的可能性):**\n    *   10:\
            \ 完全可以预料\n    *   6: 相当可能\n    *   3: 可能，但不经常\n    *   1: 可能性小，完全意外\n\
                *   0.5: 很不可能，可以设想\n    *   0.2: 极不可能\n    *   0.1: 实际不可能\n*   **E\
            \ (暴露于危险环境的频繁程度):**\n    *   10: 连续暴露\n    *   6: 每天工作时间暴露\n    *   3:\
            \ 每周一次或偶然暴露\n    *   2: 每月一次暴露\n    *   1: 每年几次暴露\n    *   0.5: 非常罕见的暴露\n\
            *   **C (发生事故造成的后果):**\n    *   100: 灾难 (3人以上死亡或5人以上职业病)\n    *   40:\
            \ 非常严重 (1-3人死亡或1人职业病)\n    *   15: 重大 (重伤)\n    *   7: 严重 (轻伤)\n    *  \
            \ 3: 存在危险 (微伤)\n    *   1: 存在可能 (需要注意)\n \n**E. 环境因素评价标准**\n \n*   **A.\
            \ 噪音**\n    *   **定量得分 R = (A1 + A2) × B × C**\n    *   **强度A1 (厂界周围):**\n\
                    *   1分: 白天≤60db、夜间≤50db\n        *   2分: 白天＞60db、夜间≤50db\n       \
            \ *   3分: 白天＜60db、夜间＞50db\n        *   4分: 白天＞60db、夜间＞50db\n    *   **强度A2\
            \ (作业现场):**\n        *   1分: ≤85db\n        *   2分: 85-90db\n        *  \
            \ 3分: ≥90db\n    *   **发生频次B:**\n        *   1分: 1次/月\n        *   2分:\
            \ 1次/周\n        *   3分: 1次/天\n        *   4分: 持续发生\n    *   **持续时间C:**\n\
                    *   1分: ≤1小时/次\n        *   2分: 1-2小时/次\n        *   3分: 2-5小时/次\n\
                    *   4分: 5-8小时/次\n        *   5分: ＞8小时/次或连续\n \n*   **B. 气体污染物**\n\
                *   **定量得分 R = A × B × C × D × E**\n    *   **对人体或环境影响的严重程度A:** 1(无影响)\
            \ - 5(产生严重伤害)\n    *   **累计排放时间B:** 1(<1小时/天) - 5(>1小时/天[严重有毒有害气体])\n\
                *   **影响范围C:** 1(作业场所) - 4(地区范围内)\n    *   **法律法规和其他要求D:** 1(无规定)\
            \ - 3(有明确规定限制)\n    *   **相关方的要求E:** 1(无要求) - 3(有明确要求)\n \n*   **C. 固/液体废弃物**\n\
                *   **定量得分 R = A × B × C × D × E × F**\n    *   **排放量A:** 1(<45吨/月)\
            \ - 5(>75吨/月)\n    *   **回收性B:** 1(可回收) - 3(不能回收)\n    *   **分解性C:** 1(可分解)\
            \ - 2(不可分解)\n    *   **对人或环境影响的严重性D:** 1(无影响) - 4(立即或长期产生伤害)\n    *  \
            \ **法律法规要求E:** 1(无规定) - 3(有明确规定限制)\n    *   **相关方要求F:** 1(无要求) - 3(有明确要求)\n\
             \n*   **D. 能源、资源消耗类**\n    *   **定量得分 R = A + B + C + D + E + F + G**\n\
                *   **使用中废弃物A:** 1(无或可回收) - 2(无法回收)\n    *   **污染性B:** 1(无污染) - 3(严重污染)\n\
                *   **潜在污染性C:** 1(无潜在污染) - 3(高度潜在污染)\n    *   **消耗量D:** 1(<1吨(万度)/月)\
            \ - 5(>10吨(万度)/月)\n    *   **法律法规要求E:** 1(无规定) - 3(有明确规定限制)\n    *   **相关方要求F:**\
            \ 1(无要求) - 3(有明确要求)\n    *   **产品报废后G:** 1(可回收) - 3(很难处理)\n \n*   **E.\
            \ 相关方（供应商）类**\n    *   **定量得分 R = A × B**\n    *   **提供产品/服务类别A:** 1(辅料/服务)\
            \ - 3(危化品/餐饮/建筑等)\n    *   **供应商性质B:** 1(店铺) - 4(外协加工商)\n \n*   **F. 潜在的环境事故**\n\
                *   **定量得分 R = A + B + C**\n    *   **事故影响范围A:** 1(作业场所) - 4(地区范围)\n\
                *   **事故影响程度B:** 1(较轻) - 3(严重)\n    *   **治理难易程度C:** 1(较易) - 3(很难)\n\
             \n*   **G. 辐射（热、光、电磁）**\n    *   **定量得分 R = A + B**\n    *   **辐射频率A:**\
            \ 1(几次/年) - 4(1次/天)\n    *   **对人或环境影响B:** 1(较小) - 2(较大)\n \n*   **重大环境因素参考标准**\n\
            | 项目 | 评价公式 | 重大环境因素参考标准 |\n| :--- | :--- | :--- |\n| 资源 | R = A+B+C+D+E+F+G\
            \ | R ≥ 15 |\n| 固/液废弃物 | R = A×B×C×D×E×F | R ≥ 100 |\n| 气体污染物 | R = A×B×C×D×E\
            \ | R ≥ 100 |\n| 噪声 | R = (A1+A2)×B×C | R ≥ 50 |\n| 供应商 | R = A×B | R\
            \ ≥ 8 |\n| 潜在事故 | R = A+B+C | R ≥ 7 |\n| 辐射 | R = A+B | R ≥ 6 |\n---\n\
            \n**示例交互**\n\n*   **用户查询：**\n    “空压机房主要的重大危险源有哪些？为什么它的风险那么高？”\n*   **理想响应：**\n\
            \    “根据《危险源识别与评价一览表》(QR-MA-052E) 第2.1.3节，空压机房识别出一项重大危险源：\n    *   **危险源：**\
            \ 储气罐物理爆炸 (事故类型: 17)\n    *   **风险评分 (D值)：** 60\n    *   **风险等级：** 重大风险\n\
            \    *   **风险分析：** 该评分是基于以下评估得出的：\n        *   **L (可能性) = 1** (可能性小，因有年检和安全阀)\n\
            \        *   **E (暴露程度) = 6** (设备24小时运行，员工每天巡检会暴露)\n        *   **C (后果)\
            \ = 10** (此处应根据实际C值表格，假设为10分，指代严重伤害但非死亡。*注：此处应根据实际表格调整*)\n        *  \
            \ **计算：D = 1 × 6 × 10 = 60** (*此处分数应根据实际表格修改*)\n    *   **主要控制措施：** 定期年检、安装和校验安全阀、压力表，并对员工进行应急操作培训。”"
        - id: 403ccd90-ab80-49dd-b104-36f9cbb48743
          role: user
          text: '用户问题：{{#sys.query#}}

            '
        selected: true
        title: 模型回答中
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '17538650652620'
      position:
        x: 3552
        y: 268.5
      positionAbsolute:
        x: 3552
        y: 268.5
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: '{{#17538650652620.text#}}'
        desc: ''
        selected: false
        title: 最终回答
        type: answer
        variables: []
      height: 105
      id: '1753865077626'
      position:
        x: 3886
        y: 268.5
      positionAbsolute:
        x: 3886
        y: 268.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: /home/user/Desktop/MODELFILE/Qwen3-30B-A3B-think-2507
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: 3fad6cae-d888-4c10-a058-ea854ebd5ef3
          role: system
          text: "你是一个专业的知识库检索引擎优化师。你的任务是将用户的自然语言问题，转换为一个由空格分隔的、高度优化的关键词查询字符串，以用于后续的向量检索或关键词检索。\n\
            \n请严格遵循以下规则：\n\n**核心规则**：\n1.  **提取核心**：只提取问题的核心名词、技术术语、专有名词和关键操作。\n2.\
            \  **保留否定**：如果问题包含明确的否定意义（如“无法”、“失败”、“不是”、“没有”、“不成功”），必须在输出中保留这些核心否定词。\n\
            3.  **过滤杂质**：过滤掉所有停止词（的、地、得）、疑问词（怎么、为什么、吗）、口语化表达（你好、请问、我找不到）和不影响核心语义的修饰词。\n\
            4.  **格式标准**：输出结果必须是一行文本，关键词之间用单个空格隔开，结尾不要有任何标点或说明。\n\n**别名替换规则**：\n*\
            \   在提取关键词的过程中，如果出现别名，必须将其转换为官方术语。具体规则如下：\n    *   `自动炒菜机` -> `野牛炒菜机`\n\
            \n**排除规则**：\n*   主动识别并删除以下词语及其近义词，不要将它们包含在最终输出中：`危险源`, `环境因素`, `安全隐患`,\
            \ `风险点`。\n\n---\n[示例开始]\n\n问题: 你好，请问在Dify里怎么创建一个RAG应用啊？我找不到入口。\n输出: Dify\
            \ 创建 RAG 应用\n\n问题: 为什么我在Dify里创建RAG应用总是失败？\n输出: Dify 创建 RAG 应用 失败\n\n问题:\
            \ 我想了解一下你们的私有化部署方案，特别是对服务器硬件有什么要求。\n输出: 私有化部署 服务器 硬件 要求\n\n问题: 把知识库接入企业微信的步骤是什么？有没有关于危险源识别的说明？\n\
            输出: 知识库 接入 企业微信 步骤\n\n问题: 自动炒菜机的使用说明书在哪里可以下载？\n输出: 野牛炒菜机 使用说明书 下载\n\n\
            [示例结束]\n---"
        - id: 6c50d509-9a0e-4d4a-b67d-83f0b14529a6
          role: user
          text: 问题如下：{{#sys.query#}}
        selected: false
        title: 提取问题关键词
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '1754535541206'
      position:
        x: 2214.326513233214
        y: 268.5
      positionAbsolute:
        x: 2214.326513233214
        y: 268.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import re\ndef main(arg1: str) -> dict:\n    clean_answer = re.sub(r'<think[^>]*>.*?</think>','',arg1,flags=re.DOTALL)\n\
          \    final_answer = re.sub(r'^\\n+','',clean_answer)\n    return {\n   \
          \     \"result\": final_answer,\n    }"
        code_language: python3
        desc: ''
        outputs:
          result:
            children: null
            type: string
        selected: false
        title: 删除模型思考
        type: code
        variables:
        - value_selector:
          - '1754535541206'
          - text
          value_type: string
          variable: arg1
      height: 54
      id: '17545355851260'
      position:
        x: 2884
        y: 268.5
      positionAbsolute:
        x: 2884
        y: 268.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: '关键词已提取：

          {{#1754535541206.text#}}

          正将以上关键词用于知识检索，请耐心等待...'
        desc: ''
        selected: false
        title: 关键词提取中
        type: answer
        variables: []
      height: 137
      id: '1754548215938'
      position:
        x: 2550
        y: 268.5
      positionAbsolute:
        x: 2550
        y: 268.5
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        memory:
          query_prompt_template: 用户问题：{{#sys.query#}}
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: false
            size: 50
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: /home/user/Desktop/MODELFILE/Qwen3-30B-A3B-think-2507
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: 81d49213-b422-43b5-92ec-fa631ffce83e
          role: system
          text: '#### **# 核心任务**

            你的任务是作为一个智能分类器。分析给定的 `[记忆窗口]` (即上下文) 和 `[用户问题]`，判断该问题是否**强依赖**于`[记忆窗口]`来生成一个准确、连贯且符合用户意图的回答。

             

            ---

             

            #### **# 输入定义**

            *   `[记忆窗口]`：代表之前的对话历史或背景信息。

            *   `[用户问题]`：代表用户当前提出的问题。

             

            ---

             

            #### **# 判断规则**

             

            **首要规则：**

            *   如果 `[记忆窗口]` 为空，**必须**输出 "no"。

             

            **特殊指令覆盖：**

            *   如果 `[用户问题]` 中明确包含“无需检索知识库”或类似表述，**必须**输出 "yes"。

             

            **如果满足以下任一条件，输出 "yes" (代表“依赖上下文”)：**

             

            1.  **直接引用与显式指令**：问题直接询问、引用 `[记忆窗口]` 的内容，或包含明确指令要求基于上下文进行操作。

                *   **关键词示例**：“根据上面说的”、“总结一下”、“继续”、“那这个呢？”、“详细说说”、“为什么会这样？”

             

            2.  **上下文延续与深化**：问题是 `[记忆窗口]` 话题的自然延续、追问、比较、要求举例、或进行推断。即使没有明确的指代词，逻辑上也紧密相连。

                *   **示例**：

                    *   记忆窗口：“苹果公司发布了新款iPhone。”

                    *   用户问题：“它的摄像头有多少像素？”

             

            3.  **寻求相关替代方案**：问题在探讨与 `[记忆窗口]` 主题相关的其他选项、解决方案或可能性。

                *   **示例**：

                    *   记忆窗口：“A方案的优点是成本低。”

                    *   用户问题：“那B方案呢？”

             

            **如果满足以下任一条件，输出 "no" (代表“不依赖上下文”)：**

             

            1.  **开启全新话题**：问题与 `[记忆窗口]` 的主题、实体、意图完全无关。

                *   **示例**：

                    *   记忆窗口：“我们来讨论一下全球气候变化。”

                    *   用户问题：“给我讲个笑话吧。”

             

            2.  **可独立回答的通用问题**：问题虽然可能与上下文主题有微弱关联，但它是一个可以独立、完整回答的通用知识性问题，无需依赖 `[记忆窗口]`
            的具体信息。

                *   **示例**：

                    *   记忆窗口：“我正在看关于特斯拉Model Y的评测。”

                    *   用户问题：“特斯拉是哪个国家的公司？” (这个问题本身是独立的，不需要评测的具体内容)

             

            ---

             

            #### **# 案例学习**

             

            *   **案例 1 (yes)**

                *   `[记忆窗口]`：“AI的发展为社会带来了许多便利，例如在医疗领域的智能诊断和金融领域的风险控制。”

                *   `[用户问题]`：“它在未来还可能有哪些应用？”

                *   **分析**：属于“上下文延续与深化”。

             

            *   **案例 2 (yes)**

                *   `[记忆窗口]`：“配料：面粉500克，水250克，酵母5克，糖10克。首先将酵母和糖溶于温水中。”

                *   `[用户问题]`：“然后呢？”

                *   **分析**：属于“直接引用与显式指令”。

             

            *   **案例 3 (no)**

                *   `[记忆窗口]`：“我计划下周去北京旅游，有什么推荐的景点吗？”

                *   `[用户问题]`：“推荐一部最近好看的电影。”

                *   **分析**：属于“开启全新话题”。

             

            *   **案例 4 (no)**

                *   `[记忆窗口]`：“iPhone 15 Pro Max采用了A17 Pro芯片，性能非常强大。”

                *   `[用户问题]`：“苹果公司的股价是多少？”

                *   **分析**：属于“可独立回答的通用问题”。虽然都和苹果有关，但回答股价问题无需知道芯片信息。

             

            *   **案例 5 (no)**

                *   `[记忆窗口]`： (空)

                *   `[用户问题]`：“你好。”

                *   **分析**：“首要规则”。

             

            ---

             

            #### **# 输出要求**

            *   严格遵循上述规则，仅输出 "yes" 或 "no"。

            *   禁止添加任何解释、理由或其他无关字符。'
        selected: false
        title: 判断是否需要根据上下文窗口回答
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '1754551381078'
      position:
        x: 1123
        y: 436
      positionAbsolute:
        x: 1123
        y: 436
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: 5554128a-b7d8-46e3-9f28-5d6fc17da7be
            value: 'no'
            varType: string
            variable_selector:
            - '1754551677124'
            - result
          id: 'true'
          logical_operator: and
        desc: ''
        selected: false
        title: IF/ELSE 2
        type: if-else
      height: 126
      id: '1754551409989'
      position:
        x: 1791
        y: 436
      positionAbsolute:
        x: 1791
        y: 436
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        memory:
          query_prompt_template: '问题如下：{{#sys.query#}}

            '
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: false
            size: 50
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: /home/user/Desktop/MODELFILE/Qwen3-30B-A3B-think-2507
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: 25f1b54a-d511-4a20-a778-d954d095d396
          role: system
          text: "## 核心任务\n严格按照以下逻辑和信息源优先级，生成一个与用户问题高度相关、准确且连贯的回答。\n\n## 信息源优先级\n1.\
            \  **记忆窗口内容（最高）**\n2.  **（可选）外部知识库**\n3.  **模型内置知识（最低，用于补充和润色）**\n\n##\
            \ 执行逻辑 (IF-ELSE结构)\n**IF** 用户明确表示“无需检索知识库”：\n    *   **THEN** 执行【**流程A：无知识库检索**】。\n\
            **ELSE** (默认情况):\n    *   **THEN** 执行【**流程B：标准检索**】。\n\n---\n### 【流程A：无知识库检索】\n\
            1.  **分析**：仅分析“记忆窗口内容”（如果存在）。\n2.  **整合**：以“记忆窗口内容”为核心，结合模型内置知识进行回答。\n\
            3.  **生成**：生成直接回应用户问题的答案。\n\n### 【流程B：标准检索】\n1.  **分析**：分析“记忆窗口内容”、“外部知识库”中的所有相关信息。\n\
            2.  **整合**：\n    *   以“记忆窗口内容”为最高优先级信息，整合所有来源的信息。\n    *   如果信息源之间存在冲突，优先采信“记忆窗口内容”。\n\
            3.  **生成**：结合模型内置知识，生成一个连贯、准确且直接回应用户问题的答案。"
        selected: false
        title: 回答上下文窗口问题
        type: llm
        variables: []
        vision:
          enabled: false
      height: 90
      id: '1754551467900'
      position:
        x: 2550
        y: 490
      positionAbsolute:
        x: 2550
        y: 490
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: '{{#1754551467900.text#}}'
        desc: ''
        selected: false
        title: 最终回答
        type: answer
        variables: []
      height: 105
      id: '1754551494598'
      position:
        x: 2884
        y: 472.45054017346513
      positionAbsolute:
        x: 2884
        y: 472.45054017346513
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "\nimport re\ndef main(arg1: str) -> dict:\n    clean_answer = re.sub(r'<think[^>]*>.*?</think>','',arg1,flags=re.DOTALL)\n\
          \    final_answer = re.sub(r'^\\n+','',clean_answer)\n    return {\n   \
          \     \"result\": final_answer,\n    }\n"
        code_language: python3
        desc: ''
        outputs:
          result:
            children: null
            type: string
        selected: false
        title: 删除模型思考
        type: code
        variables:
        - value_selector:
          - '1754551381078'
          - text
          value_type: string
          variable: arg1
      height: 54
      id: '1754551677124'
      position:
        x: 1457
        y: 436
      positionAbsolute:
        x: 1457
        y: 436
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: 您已开启上下文记忆功能，回答时长会有所增加，请耐心等待。如需关闭记忆功能，请点击左上角开启新对话~
        desc: ''
        selected: false
        title: 直接回复
        type: answer
        variables: []
      height: 134
      id: '1754556756406'
      position:
        x: 789
        y: 436
      positionAbsolute:
        x: 789
        y: 436
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    viewport:
      x: -2441.2208104312153
      y: 31.89848299690118
      zoom: 0.7884782461155727
